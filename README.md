## Структура проекта

### **bot/** (основной код бота)
- `main.py` — точка входа для запуска бота.
- `handlers.py` — обработчики команд, сообщений и callback-запросов.
- `config.py` — конфигурационные настройки (переменные окружения, лимиты, системные промпты).
- `utils.py` — вспомогательные утилиты (логирование, работа с историей чатов, обработка подписок).
- `database.py` — работа с Milvus (векторное хранилище) для поиска похожих сообщений.
- `metrics.py` — система метрик и опросов пользователей.
- `logging_config.py` — настройка логирования.

### **logs/** (автоматически создаваемая папка для логов)
- `bot.log` — основной лог-файл работы бота.
- `user_{user_id_hash}/conversation_history.json` — история переписки пользователя.

### **feedbacks/** (отзывы пользователей)
- `feedbacks.txt` — сохраненные отзывы, отправленные пользователями через бота.

### **save/** (автоматически создаваемая папка для хранения данных)
- `users.json` — список зарегистрированных пользователей.
- `premium_users.json` — список пользователей с премиум-доступом.
- `daily_limits.json` — временные ограничения общения пользователей.
- `daily_usage.json` — текущий расход символов пользователей.

### **metrics/** (данные для анализа)
- `metric1.json` — результаты опросов пользователей (качество диалога).
- `metric2.json` — анализ объема взаимодействия пользователей с ботом.
- `current_surveys.json` — активные опросы.

### **.env** (файл с переменными окружения, не загружается в репозиторий)
- `TOKEN` — API-ключ Telegram-бота.
- `OPENROUTE` — ключ для OpenRouter API.
- `ADMIN_USER_ID` — список ID администраторов бота.
- `MANAGER_USER_ID` — ID менеджера.
- `NO_API` — флаг отключения API.

## **Функциональность**

### **Общий процесс работы**
1. Пользователь отправляет сообщение в чат с ботом.
2. Бот анализирует историю переписки (контекстное окно в coversation_history.json, RAG через Milvus) и отправляет запрос в **OpenRouter API**.
3. OpenRouter API (модель **Claude-3.5-sonnet**) генерирует ответ.
4. Ответ сохраняется в истории Milvus и возвращается пользователю.

### **Премиум-доступ и лимиты**
- Бесплатные пользователи ограничены **7000 символами в день**.
- При достижении лимита включается **автоматическая суммаризация чата**.
- Премиум-пользователи общаются без ограничений (`/add_premium <USER_ID>`).

### **Система опросов и метрик**
- **metric1** — запрашивает у пользователей оценку диалога.
- **metric2** — анализирует объем общения всех пользователей.
- Команды администратора:
  - `/start_metrics metric1` — запустить опрос.
  - `/start_metrics metric2` — собрать статистику.
  - `/give_metrics metric1/metric2` — выгрузить данные метрик.

## **Развертывание и запуск**

### 1️) Клонирование репозитория
```bash
git clone git@github.com:Zeldrizz/feelix_telegram_bot.git your_dir
cd your_dir
```

### 2️) Создание виртуального окружения
```bash
pyenv deactivate
pyenv activate NAME
```

### 3️) Установка зависимостей
```bash
pip install --upgrade pip
pip install -r requirements.txt
```

### 4️) Настройка **.env** (переменные API)
Создайте `.env` в корне проекта и добавьте переменные окружения.

### 5️) Запуск бота
```bash
cd bot
python3 main.py
```